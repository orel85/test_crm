импорт Основное
импорт Пресейл

@Обработчик
метод ВычислитьРазрешенияДоступа(): Массив<РазрешениеДоступа>
    возврат [ПользователиКлиентИСервер.ПолныеПраваНаСправочникДляАутентифицированных()]
;

@Обработчик
метод ВычислитьРазрешенияДоступаДляОбъектов(Объекты: ЧитаемыйМассив<События.ДанныеРасчетаРазрешений>): Соответствие<События.ДанныеРасчетаРазрешений, Массив<РазрешениеДоступа>>
    знч Результат = <События.ДанныеРасчетаРазрешений, Массив<РазрешениеДоступа>>{:}
    
    знч СделкиСобытий = <Сделки.Ссылка>{}
    для Объект из Объекты
        СделкиСобытий.Добавить(Объект.Владелец)
    ;
    
    знч РегионыСделок = Сделки.ПолучитьРегионыСделок(СделкиСобытий)
    
    для Объект из Объекты
        знч Направление = РегионыСделок.Получить(Объект.Владелец)
    
        знч Разрешения = <РазрешениеДоступа>[
            ПользователиКлиентИСервер.ПолныеПраваНаСправочникДляРуководителя(), 
            новый РазрешениеДоступа(
                [новый КлючДоступаМенеджера.Объект(Владелец = Направление)],
                [Сущность.Право.Создание, Сущность.Право.Чтение, Сущность.Право.Изменение, Сущность.Право.Удаление])
        ]

        Результат.Вставить(Объект, Разрешения)
    ;

    возврат Результат
;
